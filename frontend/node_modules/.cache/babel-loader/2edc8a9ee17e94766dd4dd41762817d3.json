{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\juand\\\\Desktop\\\\fotoarg\\\\frontend\\\\src\\\\components\\\\ListadoFotos.js\";\nimport React, { useState, useEffect } from 'react';\nimport Row from 'react-bootstrap/Row';\nimport TarjetaImagen from './TarjetaImagen';\nimport NavBarMispublicaciones from './NavBarMispublicaciones';\nimport FotosEditorModals from './FotosEditorModals';\nimport SweetAlert from 'sweetalert2';\nimport { faFilter } from '@fortawesome/free-solid-svg-icons';\nimport PubFilter from './PubFilter';\n\nfunction ListadoFotos(props) {\n  //tiene una variable de estado y una funcion\n  // recibe un valor inicial un array vacio\n  const [fotos, setFotos] = useState([]); //Funcion que va a mostrar o ocultar el modal de FotosEditor Modal\n\n  const [ShowFotosEditorModal, setShowFotosEditorModals] = useState(false); //función que diferencia de donde viene el llamado al modal, si editar o nueva publicacion.\n\n  const [selectedFoto, setSelectedFoto] = useState(null); //Variable de estado para almacenar los favoritos\n\n  const [favoritos, setFavoritos] = useState([]); //Variable de estado para almacenar las alertas\n\n  const [alerta, setAlerta] = useState([]); //Funcion que recibe el cambio de filtros. \n\n  const handleFilterChange = filtros => {\n    props.onFilterChange(filtros);\n  };\n\n  const handleHideFotosEditorModal = () => {\n    setSelectedFoto(null); //limpia los campos del modal\n\n    setShowFotosEditorModals(false);\n  };\n\n  const onShowFotosEditorModals = () => {\n    setSelectedFoto(null); //limpia los campos cuando del modal\n\n    setShowFotosEditorModals(true);\n  }; //Llama a la función que cierra el modal y recarga el listado de mis publicaciones\n  //recibe como parametro message que lo muestra despues en el alert\n\n\n  const handleFotoSaved = message => {\n    //cierra el modal\n    setShowFotosEditorModals(false); //recarga el listado\n\n    cargarListadoFotos(); //mensaje de carga ok.\n\n    SweetAlert.fire({\n      text: message,\n      icon: 'success'\n    });\n  }; //funcion  para el cambio de stado de favoritos\n\n\n  const handleChangeFavStatus = (isFav, pubId, userId) => {\n    let url = 'http://localhost:8888/favoritos';\n    const formData = new FormData();\n    formData.append('userId', userId);\n    formData.append('pubId', pubId);\n    let method = isFav ? 'DELETE' : 'POST';\n    fetch(url, {\n      method,\n      body: formData,\n      credentials: 'include'\n    }).then(response => response.json()).then(data => {\n      cargarListadoFotos();\n      SweetAlert.fire({\n        title: data.message,\n        icon: 'success'\n      });\n    });\n  };\n\n  const handleChangeAlertStatus = (isAlert, pubId, userId) => {\n    let url = 'http://localhost:8888/alerta';\n    const formData = new FormData();\n    formData.append('userId', userId);\n    formData.append('pubId', pubId);\n    let method = isAlert ? 'DELETE' : 'POST';\n    fetch(url, {\n      method,\n      body: formData,\n      credentials: 'include'\n    }).then(response => response.json()).then(data => {\n      cargarListadoFotos();\n      SweetAlert.fire({\n        title: data.message,\n        icon: \"success\"\n      });\n    });\n  };\n\n  const cargarListadoFotos = () => {\n    let endpoint = 'fotos'; //pregunta si hay un usuario y si type es igual a mis publicaciones.\n    //si hay ususario y quiere entrar a sus publicaciones \n    //recibe el id de usuario\n    //si no devuelve el listado completo.\n    //recibe los props de app.js\n    //Declato la variable de los filtros.\n\n    const filterParams = new URLSearchParams(props.filtros); //URLSerchParams contruye la expresion. son los que va a recibir concatenados a\n\n    if (props.type === 'fotos' && props.searchPub) {\n      endpoint += '/search/' + props.searchPub;\n    } else {\n      if (props.user) {\n        switch (props.type) {\n          case 'mispublicaciones':\n            endpoint += '/user/' + props.user.id;\n            break;\n\n          case 'favoritos':\n            endpoint = 'favoritos/' + props.user.id;\n            break;\n        }\n      }\n    } //ACA BUSCA EN FAVORITOS\n\n\n    if (props.user) {\n      fetch(`http://localhost:8888/favoritos/${props.user.id}`).then(response => response.json()).then(data => {\n        setFavoritos(data);\n        fetch(`http://localhost:8888/${endpoint}?${filterParams}`).then(response => response.json()).then(data => {\n          setFotos(data);\n        });\n      });\n    } else {\n      fetch(`http://localhost:8888/${endpoint}?${filterParams}`).then(response => response.json()).then(data => {\n        setFotos(data);\n      });\n    } //ACA BUSCO ALERTAS \n\n\n    if (props.user) {\n      fetch(`http://localhost:8888/alerta/${props.user.id}`).then(response => response.json()).then(data => {\n        setAlerta(data);\n        fetch(`http://localhost:8888/${endpoint}`).then(response => response.json()).then(data => {\n          setFotos(data);\n        });\n      });\n    } else {\n      fetch(`http://localhost:8888/${endpoint}`).then(response => response.json()).then(data => {\n        setFotos(data);\n      });\n    }\n  };\n\n  useEffect(cargarListadoFotos, [props.user, props.searchPub, props.filtros]); // esta funcion se llama desde el boton editar de TarjetaImagen que llama a handleEditClick\n  //recibe el id de la foto de onClickEdit en idPhoto\n\n  const handleEditClick = idPhoto => {\n    setSelectedFoto(idPhoto); // cuardo el id de la foto seleccionada \n\n    setShowFotosEditorModals(true); // muestra el modal    \n  }; //llama ala función de delete.\n\n\n  const handleDeleteClick = idPhoto => {\n    SweetAlert.fire({\n      title: '¿Estas seguro que queres eliminar tu publicación?',\n      icon: 'question',\n      showCancelButton: true,\n      confirmButtonText: 'Confirmar',\n      cancelButtonText: 'Cancelar'\n    }).then(result => {\n      if (result.value) {\n        fetch(`http://localhost:8888/fotos/${idPhoto}`, {\n          method: 'DELETE',\n          credentials: 'include'\n        }).then(response => response.json()).then(data => {\n          if (data.status === 'ok') {\n            SweetAlert.fire({\n              text: data.message,\n              icon: 'success'\n            });\n            cargarListadoFotos();\n          } else {\n            SweetAlert.fire({\n              text: data.message,\n              icon: 'error'\n            });\n          }\n        });\n      }\n    });\n  }; //Esta función ve si es favorito o no.\n  //Si la publicación esta dentro de la variable de estado favorito\n  //El metodo filter recorre las publicaciones y si son favoritos los mete en un array nuevo\n\n\n  const isUserFav = idPub => {\n    return favoritos.filter(favorito => idPub === favorito.id).length;\n  };\n\n  const isUserAlert = idPub => {\n    return alerta.filter(alerta => idPub === alerta.id).length;\n  }; //RETORNO DE LISTADOS FOTOS\n\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, props.type === \"mispublicaciones\" && /*#__PURE__*/React.createElement(NavBarMispublicaciones, {\n    handleHideFotosEditorModal: onShowFotosEditorModals,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 277,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(Row, {\n    className: \"ml-2 mr-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 281,\n      columnNumber: 10\n    }\n  }, //recorre todo el array de productos ejecutando la funcion\n  // encada vuelta le paso una objeto a la funcion\n  //retorna un componente tarjeta foto en cada vuelta. \n  //devuelve un array que mapea los elementos de fotos\n  fotos.map(foto => {\n    return /*#__PURE__*/React.createElement(TarjetaImagen, {\n      titulo: foto.titulo,\n      autor: foto.usuario,\n      foto: foto.foto,\n      id: foto.id,\n      type: props.type,\n      onEditClick: handleEditClick //el llamado viene de tarjeta imagen\n      ,\n      onDeleteClick: handleDeleteClick,\n      user: props.user,\n      isFav: isUserFav(foto.id),\n      onChangeFavStatus: handleChangeFavStatus,\n      isAlert: isUserAlert(foto.id),\n      onChangeAlertStatus: handleChangeAlertStatus,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 292,\n        columnNumber: 29\n      }\n    });\n  })), /*#__PURE__*/React.createElement(FotosEditorModals, {\n    show: ShowFotosEditorModal,\n    handleHide: handleHideFotosEditorModal,\n    onFotoSaved: handleFotoSaved // props. que se pasa a editorModal para que se cierre el modal cuando se carga \n    ,\n    idPhoto: selectedFoto //tiene una variable de estado que viene de tarjetaImagen, que diferencia entre nuevo y editar \n    ,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 315,\n      columnNumber: 10\n    }\n  }));\n}\n\nexport default ListadoFotos;","map":{"version":3,"sources":["C:/Users/juand/Desktop/fotoarg/frontend/src/components/ListadoFotos.js"],"names":["React","useState","useEffect","Row","TarjetaImagen","NavBarMispublicaciones","FotosEditorModals","SweetAlert","faFilter","PubFilter","ListadoFotos","props","fotos","setFotos","ShowFotosEditorModal","setShowFotosEditorModals","selectedFoto","setSelectedFoto","favoritos","setFavoritos","alerta","setAlerta","handleFilterChange","filtros","onFilterChange","handleHideFotosEditorModal","onShowFotosEditorModals","handleFotoSaved","message","cargarListadoFotos","fire","text","icon","handleChangeFavStatus","isFav","pubId","userId","url","formData","FormData","append","method","fetch","body","credentials","then","response","json","data","title","handleChangeAlertStatus","isAlert","endpoint","filterParams","URLSearchParams","type","searchPub","user","id","handleEditClick","idPhoto","handleDeleteClick","showCancelButton","confirmButtonText","cancelButtonText","result","value","status","isUserFav","idPub","filter","favorito","length","isUserAlert","map","foto","titulo","usuario"],"mappings":"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","sourcesContent":["import React, {useState, useEffect} from 'react';\r\nimport Row from 'react-bootstrap/Row';\r\nimport TarjetaImagen from './TarjetaImagen';\r\nimport NavBarMispublicaciones from './NavBarMispublicaciones'\r\nimport FotosEditorModals from './FotosEditorModals';\r\nimport SweetAlert from 'sweetalert2';\r\nimport { faFilter } from '@fortawesome/free-solid-svg-icons';\r\nimport PubFilter from './PubFilter';\r\n\r\n\r\n\r\nfunction ListadoFotos(props){\r\n\r\n//tiene una variable de estado y una funcion\r\n// recibe un valor inicial un array vacio\r\nconst [fotos, setFotos] = useState([])  \r\n\r\n\r\n//Funcion que va a mostrar o ocultar el modal de FotosEditor Modal\r\nconst [ShowFotosEditorModal, setShowFotosEditorModals]  = useState(false);\r\n\r\n//función que diferencia de donde viene el llamado al modal, si editar o nueva publicacion.\r\nconst [selectedFoto, setSelectedFoto]= useState(null);\r\n\r\n//Variable de estado para almacenar los favoritos\r\nconst [favoritos, setFavoritos] = useState([]);\r\n\r\n//Variable de estado para almacenar las alertas\r\nconst [alerta, setAlerta] =useState([]);\r\n\r\n//Funcion que recibe el cambio de filtros. \r\nconst handleFilterChange = filtros =>{\r\n    props.onFilterChange(filtros)}\r\n\r\n    const handleHideFotosEditorModal = ()=>{\r\n        setSelectedFoto(null);//limpia los campos del modal\r\n        setShowFotosEditorModals(false);\r\n    }\r\n\r\n    const onShowFotosEditorModals = ()=>{\r\n        setSelectedFoto(null);//limpia los campos cuando del modal\r\n        setShowFotosEditorModals(true);\r\n    }\r\n\r\n//Llama a la función que cierra el modal y recarga el listado de mis publicaciones\r\n//recibe como parametro message que lo muestra despues en el alert\r\n    const handleFotoSaved = (message)=>{\r\n        //cierra el modal\r\n        setShowFotosEditorModals(false);\r\n        //recarga el listado\r\n        cargarListadoFotos();\r\n        //mensaje de carga ok.\r\n        SweetAlert.fire(\r\n            {\r\n                text: message,\r\n                icon: 'success'\r\n            }\r\n        );\r\n\r\n    }\r\n\r\n\r\n    //funcion  para el cambio de stado de favoritos\r\n     const handleChangeFavStatus =(isFav, pubId, userId)=>{\r\n\r\n        let url = 'http://localhost:8888/favoritos'\r\n        \r\n        const formData = new FormData();\r\n\r\n        formData.append('userId', userId);\r\n        formData.append('pubId', pubId);\r\n\r\n        let method = isFav ? 'DELETE' : 'POST'\r\n\r\n        fetch(url, {\r\n            method,\r\n            body: formData,\r\n            credentials: 'include'\r\n        }).then(response => response.json() )\r\n        .then(data =>{\r\n            cargarListadoFotos();\r\n\r\n                SweetAlert.fire({\r\n                    title: data.message,\r\n                    icon: 'success'\r\n                }\r\n            );\r\n        })\r\n    }\r\n\r\n    const handleChangeAlertStatus = (isAlert, pubId, userId)=>{\r\n\r\n        let url = 'http://localhost:8888/alerta'\r\n        \r\n        const formData = new FormData;\r\n        formData.append('userId',userId);\r\n        formData.append('pubId', pubId);\r\n\r\n        let method = isAlert ? 'DELETE' : 'POST';\r\n\r\n\r\n        fetch(url, {\r\n            method,\r\n            body: formData,\r\n            credentials : 'include'\r\n        }).then(response => response.json() )\r\n        .then(data =>{\r\n             cargarListadoFotos();\r\n             SweetAlert.fire({\r\n                     title: data.message,\r\n                     icon: \"success\"\r\n                    } \r\n                )\r\n             })\r\n        }\r\n        \r\n\r\n\r\n\r\n    const cargarListadoFotos = () =>{\r\n    \r\n        let endpoint = 'fotos';\r\n\r\n            //pregunta si hay un usuario y si type es igual a mis publicaciones.\r\n            //si hay ususario y quiere entrar a sus publicaciones \r\n            //recibe el id de usuario\r\n            //si no devuelve el listado completo.\r\n            //recibe los props de app.js\r\n\r\n//Declato la variable de los filtros.\r\nconst filterParams = new URLSearchParams(props.filtros);//URLSerchParams contruye la expresion. son los que va a recibir concatenados a\r\n\r\n        if( props.type === 'fotos' && props.searchPub){\r\n            endpoint += '/search/' +props.searchPub;\r\n        }\r\n        else{\r\n            if(props.user){\r\n                 switch (props.type){\r\n                     case 'mispublicaciones' :\r\n                            endpoint += '/user/' + props.user.id;\r\n                            break;\r\n\r\n                    case 'favoritos' : \r\n                            endpoint = 'favoritos/' + props.user.id;\r\n\r\n                            break;\r\n                 }\r\n            }\r\n        }\r\n\r\n//ACA BUSCA EN FAVORITOS\r\n if(props.user){\r\n     fetch( `http://localhost:8888/favoritos/${props.user.id}`).then(\r\n         response => response.json()\r\n     ).then(\r\n         data =>{\r\n                setFavoritos(data);\r\n\r\n                fetch(`http://localhost:8888/${endpoint}?${filterParams}`).then(\r\n                   response=> response.json()\r\n                ).then(\r\n                    data=>{\r\n                        setFotos(data);\r\n                    }\r\n                )\r\n         }\r\n     )\r\n \r\n }else{\r\n     \r\n    fetch(`http://localhost:8888/${endpoint}?${filterParams}`).then(\r\n        response=> response.json()\r\n     ).then(\r\n         data=>{\r\n             setFotos(data);\r\n         }\r\n     )\r\n }\r\n\r\n//ACA BUSCO ALERTAS \r\n if(props.user){\r\n     fetch(`http://localhost:8888/alerta/${props.user.id}`).then(\r\n         response=> response.json()\r\n         ).then(\r\n             data=>{\r\n                setAlerta(data);\r\n\r\n                fetch(`http://localhost:8888/${endpoint}`).then(\r\n                    response=> response.json()\r\n                ).then(\r\n                    data=>{\r\n                        setFotos(data)\r\n                            }\r\n                        )\r\n                    }\r\n                )\r\n            \r\n        }else{\r\n            fetch(`http://localhost:8888/${endpoint}`).then(\r\n                    response=> response.json()\r\n                ).then(\r\n                    data=>{\r\n                        setFotos(data)\r\n                            }\r\n                        )\r\n        }\r\n }\r\n\r\n\r\nuseEffect(cargarListadoFotos , [props.user, props.searchPub, props.filtros]);\r\n\r\n\r\n// esta funcion se llama desde el boton editar de TarjetaImagen que llama a handleEditClick\r\n//recibe el id de la foto de onClickEdit en idPhoto\r\nconst handleEditClick = (idPhoto)=>{\r\n\r\n    setSelectedFoto(idPhoto);// cuardo el id de la foto seleccionada \r\n    setShowFotosEditorModals(true); // muestra el modal    \r\n}\r\n//llama ala función de delete.\r\nconst handleDeleteClick = (idPhoto)=>{\r\n    SweetAlert.fire({\r\n        title: '¿Estas seguro que queres eliminar tu publicación?',\r\n        icon: 'question',\r\n        showCancelButton: true,\r\n        confirmButtonText: 'Confirmar',\r\n        cancelButtonText: 'Cancelar'\r\n    }).then( result=> {\r\n        if(result.value){\r\n            fetch(`http://localhost:8888/fotos/${idPhoto}`,\r\n            {\r\n                method: 'DELETE',\r\n                credentials: 'include'\r\n             }\r\n            ).then( response => response.json()\r\n            ).then(\r\n                data=>{\r\n                    if(data.status === 'ok'){\r\n                        SweetAlert.fire({\r\n                            text: data.message,\r\n                            icon: 'success'\r\n                        })\r\n                        cargarListadoFotos();\r\n                    }\r\n                    else{\r\n                        SweetAlert.fire({\r\n                            text: data.message,\r\n                            icon: 'error'\r\n                        })\r\n                    }\r\n                }\r\n            )\r\n        }\r\n    })\r\n \r\n}\r\n\r\n//Esta función ve si es favorito o no.\r\n//Si la publicación esta dentro de la variable de estado favorito\r\n//El metodo filter recorre las publicaciones y si son favoritos los mete en un array nuevo\r\nconst isUserFav = idPub =>{\r\n    return ( favoritos.filter(favorito => idPub === favorito.id).length )\r\n      \r\n}\r\n\r\nconst isUserAlert = idPub =>{\r\n    return (alerta.filter(alerta=> idPub === alerta.id).length);\r\n}\r\n\r\n\r\n\r\n//RETORNO DE LISTADOS FOTOS\r\n\r\n    return(\r\n        <>\r\n        {props.type === \"mispublicaciones\" &&\r\n        <NavBarMispublicaciones handleHideFotosEditorModal={onShowFotosEditorModals}/>\r\n        }\r\n           \r\n   \r\n         <Row className=\"ml-2 mr-2\">\r\n\r\n             {\r\n                 \r\n                 //recorre todo el array de productos ejecutando la funcion\r\n                 // encada vuelta le paso una objeto a la funcion\r\n                 //retorna un componente tarjeta foto en cada vuelta. \r\n                 //devuelve un array que mapea los elementos de fotos\r\n                \r\n                 fotos.map( foto=>{ \r\n                        return(\r\n                            <TarjetaImagen  titulo={foto.titulo}\r\n                                            autor={foto.usuario}\r\n                                            foto={foto.foto}\r\n                                            id={foto.id}\r\n                                            type={props.type}\r\n                                            onEditClick={handleEditClick}//el llamado viene de tarjeta imagen\r\n                                            onDeleteClick={handleDeleteClick}\r\n                                            user={props.user}\r\n                                            isFav={ isUserFav(foto.id)}\r\n                                            onChangeFavStatus={handleChangeFavStatus}\r\n                                            isAlert={isUserAlert(foto.id)}\r\n                                            onChangeAlertStatus={handleChangeAlertStatus}\r\n                                            \r\n                            />\r\n                        )   \r\n                    }\r\n                 )\r\n             }\r\n\r\n\r\n         </Row>\r\n\r\n\r\n         <FotosEditorModals show={ShowFotosEditorModal} \r\n                            handleHide={handleHideFotosEditorModal}\r\n                            onFotoSaved={handleFotoSaved}// props. que se pasa a editorModal para que se cierre el modal cuando se carga \r\n                            idPhoto={selectedFoto}//tiene una variable de estado que viene de tarjetaImagen, que diferencia entre nuevo y editar \r\n                            />\r\n\r\n         </>\r\n    );\r\n}\r\n\r\nexport default ListadoFotos;"]},"metadata":{},"sourceType":"module"}